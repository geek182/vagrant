---
- hosts: all
  become: yes
  tasks:
    - name: Add elastic apt-key
      apt_key: 
        url: https://artifacts.elastic.co/GPG-KEY-elasticsearch
        state: present 
    
    - name: Add repository
      apt_repository:
        repo: deb https://artifacts.elastic.co/packages/8.x/apt stable main
        state: present
          
    - name: Install the latest version of the Filebeat
      apt: 
        name: filebeat
        state: latest

    - name: Enable filebeat service
      systemd:
        name: filebeat
        daemon_reload: yes
        enabled: yes
